<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="Owner">

	<insert id="EnrollRestaurant">
		INSERT INTO
		    restaurant(
		        restaurant_idx,
		        brand_name,
		        address,
		        brand_tel,
		        introduce,
		        enroll_date,
		        owner_idx,
		        category_name,
		        table_type
		    )
		VALUES(
		    (SELECT
		        MAX(restaurant_idx) + 1
		    FROM
		        restaurant),
		    #{brandName},
		    #{address},
		    #{brandTel},
		    #{introduce},
		    SYSDATE,
		    #{ownerIdx},
		    #{categoryName},
		    3
		)
	</insert>
	
	<select id="MyRestaurantList"
		resultType="com.green.restaurant.owner.vo.OwnerRestaurantVo">
		SELECT
			restaurant_idx as restaurantIdx,
			brand_name as brandName,
			address as address,
			brand_tel as brandTel,
			introduce as introduce,
			enroll_date as enrollDate,
			owner_idx as ownerIdx,
			category_name as categoryName,
			table_type as tableType
		FROM
			restaurant
		WHERE
			owner_idx = #{ownerIdx}
	</select>
	
	<select id="GetMyRestaurantInfo"
		resultType="com.green.restaurant.owner.vo.OwnerRestaurantMenuFileJoinVo">
		SELECT
		    r.restaurant_idx,
		    r.brand_name,
		    r.address,
		    r.brand_tel,
		    r.introduce,
		    r.enroll_date,
		    r.owner_idx,
		    r.category_name,
		    m.menu_idx,
		    m.menu_name,
		    m.menu_price,
		    f.file_idx,
		    f.file_name,
		    f.file_ext,
		    f.sfile_name
		FROM
		    restaurant r
		JOIN
		    menu m
		ON
		    r.restaurant_idx = m.restaurant_idx
		JOIN
		    img_file f
		ON
		    m.table_type = f.table_type
		WHERE
		    m.menu_idx = f.table_idx
		AND
		    r.restaurant_idx = #{restaurant_idx}
	</select>
	
	<insert id="EnrollMenu">	
		INSERT INTO
			menu(
				menu_idx,
				menu_name,
				menu_price,
				restaurant_idx,
				table_type
			)
		VALUES(
			(SELECT
				MAX(menu_idx)+1
			FROM
				menu),
			#{menu_name},
			#{menu_price},
			#{restaurant_idx},
			2
		)
	</insert>
	
	<select id="GetReviewList"
		resultType="com.green.restaurant.owner.vo.OwnerBoardVo">
		SELECT
		    board_idx,
		    board_type,
		    board_title,
		    board_content,
		    review_avg,
		    reg_date as boardRegDate,
		    restaurant_idx,
		    view_cnt,
		    user_id as boardWriter,
		    cnt_like,
		    cnt_hate,
		    address
		FROM
		    board
		WHERE
		    restaurant_idx = #{restaurant_idx}
	</select>
	
	<select id="getReviewCommentList"
		resultType="com.green.restaurant.owner.vo.OwnerCommentVo">
		SELECT
		    comment_idx,
		    user_id as commentWriter,
		    comment_content,
		    board_idx as boardIdx,
		    reg_date as commentRegDate,
		    lvl,
		    step,
		    cnum,
		    nref
		FROM
		    board_comment
		WHERE
		    board_idx = #{board_idx}
	</select>
	
	<select id="getReview"
		resultType="com.green.restaurant.owner.vo.OwnerBoardVo">
		SELECT
		    board_idx,
		    board_type,
		    board_title,
		    board_content,
		    review_avg,
		    reg_date as boardRegDate,
		    restaurant_idx,
		    view_cnt,
		    user_id as boardWriter,
		    cnt_like,
		    cnt_hate,
		    address
		FROM
		    board
		WHERE
		    board_idx = #{board_idx}
	</select>
	
	<select id="getCategoryList"
		resultType="com.green.restaurant.owner.vo.OwnerCategoryVo">
		SELECT
			category_idx,
			category_name
		FROM
			rcategory
		ORDER BY
			category_idx
	</select>
	
	<select id="getRestaurantIdx"
		resultType="int">
		SELECT
			MAX(restaurant_idx)
		FROM
			restaurant
		WHERE
			owner_idx=#{owner_idx}
	</select>
	
	<select id="getMenuList"
		resultType="com.green.restaurant.owner.vo.OwnerMenuFileJoinVo">
		SELECT
		    m.menu_name,
		    m.menu_price,
		    f.sfile_name
		FROM
		    menu m
		JOIN
		    img_file f
		ON
		    m.menu_idx = f.table_idx
		WHERE
		    f.table_type = 2
		AND
		    m.restaurant_idx = #{restaurant_idx}
	</select>
	
	<insert id="insertOwnerInfo">
		INSERT INTO
			towner
		VALUES(
			(SELECT
				MAX(owner_idx) + 1
			FROM
				towner),
			#{user_id},
			#{owner_num},
			0
		)
	</insert>
	
</mapper>